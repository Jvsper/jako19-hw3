<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Homework 3 : Jasper Kolp</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

	<!-- The following script is used for generating hash -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
</head>
<body>
	<h1> Comics by Marvel Characters </h1>

	<form id="comic_search" method="GET">
		<label for="chracter">Chracter Name : <input id="character" type="text" name="character"> 
			<input type="submit" value="Submit">
	</form>

	<div id="list_of_comics">
		<p id="charInfo"></p>
	</div>

	<script>
	// To access Marvel's Public API
		const public_key = "74e2999625dc86ce7eb5f9dd6e589b17";
		const private_key = "c1151fbc71cde5b20437b7c674767b779ead65ee";
		const url ="https://gateway.marvel.com:443/v1/public/characters?"
		var ts = Date.now();
		var hash = CryptoJS.MD5(ts + private_key + public_key).toString();

		let charList = [];  // Array of all characters
		


		$("#character").on("change", function() {
			var characterName = $("#character").val();
			console.log(characterName);
			allChar(); // Fills in the charList array

			for (let i = 0; i < charList.length; i++)
			{	
				if(charList[i].name == characterName)
				{
					$("#charInfo").html("Name : " + charList[i].name + "\n");

					for (let j=0; j < charList[i].series.items.length; j++){
						$("#charInfo").append("Series : " + charList[i].series.items[j].name + "\n");
					}
										
				}
			} 

			var endpoint = url + "name=" + characterName + "&ts=" + ts + "&apikey=" + public_key + "&hash=" + hash;

			console.log(endpoint);

			

			console.log("*********************** List of all Characters ***********************")
			for(let j=0; j < charList.length; j++)
			{
				console.log(charList[j]);
			}
		})

		function allChar() {
			let offset = 0;
			const limit = 100;
			let count = 1;

			for(let i=0; i < 15; i++)
			{
				$.ajax({
					url : "https://gateway.marvel.com:443/v1/public/characters?ts=" + ts + "&apikey=74e2999625dc86ce7eb5f9dd6e589b17&hash=" + hash + "&limit=" + limit + "&offset=" + offset,
					dataType : "json",
					success : function (result, status){
						console.log("https://gateway.marvel.com:443/v1/public/characters?ts=" + ts + "&apikey=74e2999625dc86ce7eb5f9dd6e589b17&hash=" + hash);

						var characterList = result.data.results;
						console.log(characterList);

					// Pushing each character name into the charList array
						characterList.forEach(function(char){
						charList.push(char);
						//console.log(count + " : " + char.name);
						count += 1;
						})
							
					}
				})
				offset = offset + 100;
			}
		}

				
			 
	</script>
</body>
</html>